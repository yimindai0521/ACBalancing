<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>package_intro • ACBalancing</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="package_intro">
<meta property="og:description" content="ACBalancing">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ACBalancing</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/package_intro.html">package_intro</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>package_intro</h1>
            
      
      
      <div class="hidden name"><code>package_intro.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ACBalancing</span><span class="op">)</span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Consider a random sample of <span class="math inline">\(n\)</span>
individuals from a population. Let <span class="math inline">\(T\)</span> be a binary treatment indicator with
<span class="math inline">\(T=1\)</span> if the individual is treated
and <span class="math inline">\(T=0\)</span> otherwise. Let <span class="math inline">\(X=\left(X_1, \cdots, X_p\right)^{\top}\)</span> be
a <span class="math inline">\(p\)</span>-dimensional vector of
pre-treatment covariates. Let <span class="math inline">\(Y\)</span> be
the binary outcome. The observed data are <span class="math inline">\(\left\{\left(X_i, T_i, Y_i\right): i=1, \cdots,
n\right\}\)</span>, which are <span class="math inline">\(n\)</span>
independent and identically distributed triples <span class="math inline">\((X, T, Y)\)</span>. Under the potential outcome
framework <span class="citation">Imbens and Rubin (2015)</span>, we
define a pair of potential outcomes <span class="math inline">\(\{Y(0),
Y(1)\}\)</span> for each individual if he/she were not treated or
treated. The observed outcome is defined as <span class="math inline">\(Y=(1-T) Y(0)+T Y(1)\)</span>.</p>
<p>The causal estimand of interest is the average treatment effect
(ATE), defined by <span class="math inline">\(\tau=E\{Y(1)-Y(0)\}=\mu_1-\mu_0\)</span>, where
<span class="math inline">\(\mu_j=E\{Y(j)\}, j=0,1\)</span>. The
proposed method can be changed to other causal estimands, e.g., average
treatment effect on the treated (ATT). Under the strong ignorability and
overlap assumption <span class="citation">Imbens and Rubin
(2015)</span>, we can show that <span class="math inline">\(\mu_1=E\left\{\mu_1(X)\right\} =
E\left\{\frac{TY}{Pr(T = 1 \mid X)}\right\}\)</span> and <span class="math inline">\(\mu_0=E\left\{\mu_0(X)\right\} =
E\left\{\frac{(1-T)Y}{Pr(T = 0 \mid X)}\right\}\)</span>. Therefore, we
can estimate <span class="math inline">\(\mu_1\)</span> by estimating
propensity score <span class="math inline">\(Pr(T = 1 \mid
X)}\)</span>.</p>
</div>
<div class="section level2">
<h2 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<p>The goal for propensity score <span class="math inline">\(Pr(T = 1
\mid X)}\)</span> is to balance the covariate, i.e, <span class="math display">\[E\left\{\frac{Tf(X)}{Pr(T = 1 \mid X)}\right\} =
E\left\{Tf(X)\right\}\]</span> where <span class="math inline">\(f(X)\)</span> is a function of <span class="math inline">\(X\)</span>.</p>
<p>In finite sample, the above formula is <span class="math display">\[\sum_{i=1}^{n}\frac{T_if(X_i)}{\hat{Pr}(T = 1
\mid X_i)} = \sum_{i=1}^{n}f(X_i)\]</span> This motivates covariate
balancing method, that is, we directly balance covariate instead of
estimating propensity score method. The most well-known method is
entropy balancing <span class="citation">Hainmueller (2012)</span> and
stable weighting <span class="citation">Zubizarreta (2015)</span>.</p>
<p><span class="math display">\[
\begin{array}{ll}
\underset{\boldsymbol{w}}{\operatorname{minimize}} &amp; \sum_{i=1}^{n}
T_if(w_i) \\
\text { subject to } &amp; \sum_{i=1}^{n}\boldsymbol{w_iT_i}
\boldsymbol{f(X)} = \sum_{i=1}^{n}f(X_i) / n\\
&amp; \mathbf{1}^{\top} \boldsymbol{w}=1, \\
&amp; \boldsymbol{w} \succeq 0,
\end{array}
\]</span> when <span class="math inline">\(f(w) = (w -
\frac{1}{n})^2\)</span>, it’s stable weighting and when <span class="math inline">\(f(w) = w\log(w)\)</span>, it’s entropy
balancing.</p>
<p>However, the exact balancing condition (<span class="math inline">\(\sum_{i=1}^{n}\boldsymbol{w_iT_i}
\boldsymbol{f(X)} = \sum_{i=1}^{n}f(X_i) / n\)</span>) may not hold in
finite sample. We call this “Bad Overlap” situation when we cannot find
a solution <span class="math inline">\(w\)</span> to fulfill the exact
balancing condition. The “Bad Overlap” may happen when <span class="math inline">\(E\{Pr(T = 1 \mid X)\}\)</span> closes to 0 or 1,
<span class="math inline">\(E\{ X \mid T = 1\}\)</span> and <span class="math inline">\(E\{ X \mid T = 0\}\)</span> are significantly
different or the covariate is high-dimensional.</p>
<p>To alleviate the feasibility problem, <span class="citation">Wang and
Zubizarreta (2020)</span> proposed minimal dispersion approximately
balancing weights (MDABW) as an univariate approximate balancing
framework, which relaxes the balancing conditions by using inequality
constraints.</p>
<p><span class="math display">\[
\begin{array}{ll}
\underset{\boldsymbol{w}}{\operatorname{minimize}} &amp; \sum_{i=1}^{n}
T_if(w_i) \\
\text { subject to } &amp; |\sum_{i=1}^{n}\boldsymbol{w_iT_i}
\boldsymbol{f(X)} - \sum_{i=1}^{n}f(X_i) / n | \leq \delta_k, \quad k =
1,\cdots,d\\
&amp; \boldsymbol{w} \succeq 0,
\end{array}
\]</span> There are other robust balancing methods which may not suffer
the feasibility problem. <span class="citation">(<strong>xxu2021hierarchically?</strong>)</span>
imposes ridge penalties in the optimization problem. <span class="citation">Wong and Chan (2018)</span> minimized covariate
imbalance directly by the regularized kernel regression method.</p>
<p>There is a potential issue with univariate approximate balancing. The
unvariate balance does not guarantee overall balance, especially in the
case of bad-overlap scenario, as shown in the numerical study. Another
issue is that there is no principled way to select the threshold
parameters simultaneously. Extension of MDABW to handle “Bad Overlap”
issue remains an open work.</p>
<p>Multivariate covariate balance can greatly help overcome the
limitations of univariate approximate balancing. Also, we provide a
single threshold parameter attached to the quadratic inequality
constraint in Mahalanobis balancing method, which greatly handles the
issue of multiple threshold parameters. In practice, the Mahalanobis
balancing method has good performance (low bias, small balancing
diagnostics) especially in “Bad Overlap” situations.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Install the "ACBalancing" package from github.</span>
<span class="co"># if (!require(c("devtools", "WeightIt", "MASS", "ATE.ncb"))){</span>
<span class="co">#     install.packages(c("devtools", "WeightIt", "MASS", "ATE.ncb"))</span>
<span class="co"># }</span>
<span class="co"># devtools::install_github("yimindai0521/ACBalancing")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ngreifer.github.io/WeightIt/" class="external-link">WeightIt</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ATE.ncb</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get-started">Get Started<a class="anchor" aria-label="anchor" href="#get-started"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0521</span><span class="op">)</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/si.data.html">si.data</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">result1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MB.html">MB</a></span><span class="op">(</span>covariate <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">X</span>, treat <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Tr</span>, group1 <span class="op">=</span> <span class="fl">1</span>, outcome <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Y</span>, opti.method <span class="op">=</span> <span class="st">"proximalC"</span>, method <span class="op">=</span> <span class="st">"MB"</span><span class="op">)</span>
<span class="va">result2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MB.html">MB</a></span><span class="op">(</span>covariate <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">X</span>, treat <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Tr</span>, group1 <span class="op">=</span> <span class="fl">0</span>, outcome <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Y</span>, opti.method <span class="op">=</span> <span class="st">"proximalC"</span>, method <span class="op">=</span> <span class="st">"MB"</span><span class="op">)</span>
<span class="va">result3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/UB.html">UB</a></span><span class="op">(</span>covariate <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">X</span>, treat <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Tr</span>, group1 <span class="op">=</span> <span class="fl">1</span>, outcome <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Y</span>, opti.method <span class="op">=</span> <span class="st">"proximal"</span><span class="op">)</span>
<span class="va">result4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/UB.html">UB</a></span><span class="op">(</span>covariate <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">X</span>, treat <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Tr</span>, group1 <span class="op">=</span> <span class="fl">0</span>, outcome <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Y</span>, opti.method <span class="op">=</span> <span class="st">"proximal"</span><span class="op">)</span>
<span class="va">result5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/HRB.html">HRB</a></span><span class="op">(</span>covariate <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">X</span>, treat <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Tr</span>, group1 <span class="op">=</span> <span class="fl">1</span>, outcome <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span>
<span class="va">result6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/HRB.html">HRB</a></span><span class="op">(</span>covariate <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">X</span>, treat <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Tr</span>, group1 <span class="op">=</span> <span class="fl">0</span>, outcome <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span>

<span class="co"># estimating ATE</span>
<span class="va">result1</span><span class="op">$</span><span class="va">AT</span> <span class="op">-</span> <span class="va">result2</span><span class="op">$</span><span class="va">AT</span>
<span class="co">#&gt;             [,1]</span>
<span class="co">#&gt; [1,] -0.09062922</span>
<span class="va">result3</span><span class="op">$</span><span class="va">AT</span> <span class="op">-</span> <span class="va">result4</span><span class="op">$</span><span class="va">AT</span>
<span class="co">#&gt;            [,1]</span>
<span class="co">#&gt; [1,] -0.3050739</span>
<span class="va">result5</span><span class="op">$</span><span class="va">AT</span> <span class="op">-</span> <span class="va">result6</span><span class="op">$</span><span class="va">AT</span>
<span class="co">#&gt;           [,1]</span>
<span class="co">#&gt; [1,] -1.699096</span>

<span class="co"># parameter for propensity score (\beta_1-\beta_0)</span>
<span class="va">result1</span><span class="op">$</span><span class="va">parameter</span> <span class="op">-</span> <span class="va">result2</span><span class="op">$</span><span class="va">parameter</span>
<span class="co">#&gt;  [1] -1.1518241 -1.0545769 -1.0520829 -1.0464248 -0.8595482 -0.9518586</span>
<span class="co">#&gt;  [7] -1.1951607 -0.9784473 -0.7472358 -1.0972427</span>
<span class="va">result3</span><span class="op">$</span><span class="va">parameter</span> <span class="op">-</span> <span class="va">result4</span><span class="op">$</span><span class="va">parameter</span>
<span class="co">#&gt;  [1] -1.0302661 -0.9437848 -0.9260702 -0.9018889 -0.7300226 -0.8570399</span>
<span class="co">#&gt;  [7] -1.0816920 -0.8540281 -0.6279106 -0.9776652</span>
<span class="va">result5</span><span class="op">$</span><span class="va">parameter</span> <span class="op">-</span> <span class="va">result6</span><span class="op">$</span><span class="va">parameter</span>
<span class="co">#&gt;  [1] -1.00822314 -0.88978320 -0.90945911 -0.85567497 -0.87569403 -0.80774895</span>
<span class="co">#&gt;  [7] -1.22235684 -0.79016829 -0.73934671 -1.01794959  0.19432913  0.10708127</span>
<span class="co">#&gt; [13]  0.02286443  0.44085498 -0.03203781  0.40795985  0.07075453  0.23114038</span>
<span class="co">#&gt; [19] -0.20991753 -0.55456561  0.06471220  0.15484861  0.13962965  0.23039468</span>
<span class="co">#&gt; [25]  0.26976979  0.37303730  0.19676246 -0.23523827  0.22430919  0.29292812</span>
<span class="co">#&gt; [31]  0.23453506  0.09541227  0.04338214  0.18045949 -0.03662074 -0.30293394</span>
<span class="co">#&gt; [37] -0.15193972  0.04465865  0.04105995 -0.08180647  0.33285409  0.32181753</span>
<span class="co">#&gt; [43] -0.09391965 -0.12663696  0.14512927 -0.12718189  0.08379626 -0.10536265</span>
<span class="co">#&gt; [49]  0.08454828  0.34582449  0.16244867  0.12432401 -0.02665074 -0.02894742</span>
<span class="co">#&gt; [55] -0.15578071  0.11829491 -0.25354724  0.01291753  0.14667217 -0.12115149</span>
<span class="co">#&gt; [61]  0.10876722 -0.19944861 -0.22414815  0.14515818  0.05456086 -0.58982041</span>
<span class="co">#&gt; [67] -0.27003607 -0.42898200 -0.47544172 -0.14920329 -0.48618227 -0.22381181</span>
<span class="co">#&gt; [73] -0.56679843 -0.12614355 -0.52749815</span>

<span class="co"># Generalized Mahalobnis Imbalance Measure</span>
<span class="va">result1</span><span class="op">$</span><span class="va">GMIM</span> <span class="op">+</span> <span class="va">result2</span><span class="op">$</span><span class="va">GMIM</span>
<span class="co">#&gt; [1] 3.593262e-07</span>
<span class="va">result3</span><span class="op">$</span><span class="va">GMIM</span> <span class="op">+</span> <span class="va">result4</span><span class="op">$</span><span class="va">GMIM</span>
<span class="co">#&gt; [1] 0.01338146</span>
<span class="va">result5</span><span class="op">$</span><span class="va">GMIM</span> <span class="op">+</span> <span class="va">result6</span><span class="op">$</span><span class="va">GMIM</span>
<span class="co">#&gt; [1] 0.3609052</span></code></pre></div>
<p>In function <code>si.data</code>, we generate the treatment
assignment from the logistic regression model: <span class="math inline">\(Pr(T = 1 | X) = 1/ (1 + \exp(X_1 + ... +
X_{10}))\)</span>. The ratio <span class="math inline">\(Pr(T = 1 | X) /
Pr(T = 0 | X) \text{ is } \exp(- X_1 - ... - X_{10})\)</span>.
Similarly, Mahalanobis balancing assume the propensity score model is
<span class="math inline">\(Pr(T = a | X) =
\exp(\beta_a^{\top}X)\)</span>, then the ratio is <span class="math inline">\(Pr(T = 1 | X) / Pr(T = 0 | X) will be
\exp((\beta_1-\beta_0)^{\top}X)\)</span>, see <span class="citation">Zhao (2019)</span> for more details. In simulation, our
result
<code>result1$parameter - result2$parameter = (-1.07, -1.07, -1.02, -1.00,  -0.83, -0.95, -1.19, -0.96, -0.73, -1.06)</code>
approximates to the true value <span class="math inline">\(-(1,1,1,1,1,1,1,1,1,1,1,1)\)</span>.</p>
</div>
<div class="section level2">
<h2 id="balancing-covariate-in-finite-sample">Balancing Covariate in Finite Sample<a class="anchor" aria-label="anchor" href="#balancing-covariate-in-finite-sample"></a>
</h2>
<p>We discuss our method in “Bad Overlap” setting. We generate treatment
indicator <span class="math inline">\(T\)</span> from <span class="math inline">\(Bernoulli(0.5)\)</span> for each observation. The
observed covariates depend on treatment assignment. If <span class="math inline">\(T = 1\)</span>, then <span class="math inline">\(X
\sim N(2, \Sigma)\)</span> where the jth row and kth column of <span class="math inline">\(\Sigma\)</span> is <span class="math inline">\(\rho^{|j−k|}\)</span> and we set <span class="math inline">\(\rho = 1/2\)</span>, otherwise, <span class="math inline">\(X \sim N(0,I)\)</span>. The observed outcome is
generated from: <span class="math inline">\(Y(T) = (1 - T)(X_1 + ... +
X_{10}) + T(X_1 + ... + X_{10}) / 2\)</span>. In this setting, <span class="math inline">\(E\{ X \mid T = 1\}\)</span> and <span class="math inline">\(E\{ X \mid T = 0\}\)</span> are significantly
different and thus it’s a very “Bad Overlap” situation.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span>
<span class="va">si.data.imbal</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sample.size</span> <span class="op">=</span> <span class="fl">500</span>, <span class="va">dimension</span> <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">covmatrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">dimension</span>, <span class="va">dimension</span><span class="op">)</span>
  <span class="va">treat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">sample.size</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span>
  <span class="va">z1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="va">sample.size</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">dimension</span><span class="op">)</span>, Sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">dimension</span><span class="op">)</span><span class="op">)</span>
  <span class="va">z0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="va">sample.size</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">dimension</span><span class="op">)</span>, Sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">dimension</span><span class="op">)</span><span class="op">)</span>
  <span class="va">X</span> <span class="op">&lt;-</span> <span class="va">treat</span> <span class="op">*</span> <span class="va">z1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">treat</span><span class="op">)</span> <span class="op">*</span> <span class="va">z0</span>
  <span class="va">noise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">sample.size</span><span class="op">)</span>
  <span class="va">Y</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">treat</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span> <span class="op">+</span> <span class="va">noise</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, treat <span class="op">=</span> <span class="va">treat</span>, Y <span class="op">=</span> <span class="va">Y</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># sample.size = 500</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1999</span><span class="op">)</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">si.data.imbal</span><span class="op">(</span>sample.size <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>
<span class="fu"><a href="../reference/MB.html">MB</a></span><span class="op">(</span>covariate <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">X</span>, treat <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">treat</span>, group1 <span class="op">=</span> <span class="fl">1</span>, outcome <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Y</span>, method <span class="op">=</span> <span class="st">"MB"</span>, opti.method <span class="op">=</span> <span class="st">"proximalC"</span><span class="op">)</span><span class="op">$</span><span class="va">GMIM</span>
<span class="co">#&gt; [1] 0.2601674</span>
<span class="fu"><a href="../reference/MB.html">MB</a></span><span class="op">(</span>covariate <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">X</span>, treat <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">treat</span>, group1 <span class="op">=</span> <span class="fl">0</span>, outcome <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Y</span>, method <span class="op">=</span> <span class="st">"MB"</span>, opti.method <span class="op">=</span> <span class="st">"proximalC"</span><span class="op">)</span><span class="op">$</span><span class="va">GMIM</span>
<span class="co">#&gt; [1] 1.701903</span>

<span class="co">## sample.size = 5000</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">si.data.imbal</span><span class="op">(</span>sample.size <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span>
<span class="fu"><a href="../reference/MB.html">MB</a></span><span class="op">(</span>covariate <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">X</span>, treat <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">treat</span>, group1 <span class="op">=</span> <span class="fl">1</span>, outcome <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Y</span>, method <span class="op">=</span> <span class="st">"MB"</span>, opti.method <span class="op">=</span> <span class="st">"proximalC"</span><span class="op">)</span><span class="op">$</span><span class="va">GMIM</span>
<span class="co">#&gt; [1] 0.003029487</span>
<span class="fu"><a href="../reference/MB.html">MB</a></span><span class="op">(</span>covariate <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">X</span>, treat <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">treat</span>, group1 <span class="op">=</span> <span class="fl">0</span>, outcome <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Y</span>, method <span class="op">=</span> <span class="st">"MB"</span>, opti.method <span class="op">=</span> <span class="st">"proximalC"</span><span class="op">)</span><span class="op">$</span><span class="va">GMIM</span>
<span class="co">#&gt; [1] 0.03736832</span>

<span class="co">## sample.size = 50000</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">si.data.imbal</span><span class="op">(</span>sample.size <span class="op">=</span> <span class="fl">50000</span><span class="op">)</span>
<span class="fu"><a href="../reference/MB.html">MB</a></span><span class="op">(</span>covariate <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">X</span>, treat <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">treat</span>, group1 <span class="op">=</span> <span class="fl">1</span>, outcome <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Y</span>, method <span class="op">=</span> <span class="st">"MB"</span>, opti.method <span class="op">=</span> <span class="st">"proximalC"</span><span class="op">)</span><span class="op">$</span><span class="va">GMIM</span>
<span class="co">#&gt; [1] 1.795213e-07</span>
<span class="fu"><a href="../reference/MB.html">MB</a></span><span class="op">(</span>covariate <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">X</span>, treat <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">treat</span>, group1 <span class="op">=</span> <span class="fl">0</span>, outcome <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Y</span>, method <span class="op">=</span> <span class="st">"MB"</span>, opti.method <span class="op">=</span> <span class="st">"proximalC"</span><span class="op">)</span><span class="op">$</span><span class="va">GMIM</span>
<span class="co">#&gt; [1] 1.298165e-07</span></code></pre></div>
<p>When the sample size = 500, we find that GMIM is quite large and thus
we not recommend to use MB method to estimate average treatment effect.
MB method may not approximately balances covariate in finite sample in
very ``Bad Overlap” setting. However, when the sample size = 5000, we
find that GMIM is relatively small. Therefore, we can use the result
that produced by MB method. When the GMIM is relatively small, we
recommend to use MB method to estimate average treatment effect.</p>
</div>
<div class="section level2">
<h2 id="implementation-of-other-covariate-balancing-methods">Implementation of other covariate balancing methods<a class="anchor" aria-label="anchor" href="#implementation-of-other-covariate-balancing-methods"></a>
</h2>
<p>We provide function <code>covbal</code> (using R package
<code>Weightit</code> <span class="citation">Greifer (2022)</span>) to
implement Mahalanobis balancing method and other covariate balancing
methods, including inverse probability weighting (ps) in <span class="citation">Rosenbaum (1987)</span>, entropy balancing (ebal) in
<span class="citation">Hainmueller (2012)</span>, covariate balancing
propensity score (cbps) in <span class="citation">Imai and Ratkovic
(2014)</span>, energy balancing (energy) in <span class="citation">Huling and Mak (2020)</span>, minimal dispersion
approximate balancing weights (UB) in <span class="citation">Wang and
Zubizarreta (2020)</span>, kernel-based covariate balancing (kernel) in
<span class="citation">Wong and Chan (2018)</span> and @.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">covbal</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span>, <span class="va">Tr</span>, <span class="va">Y</span>, <span class="va">MB.only</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">data.matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">X</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Tr</span><span class="op">)</span><span class="op">)</span>
  <span class="va">sample.size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
  <span class="va">dimension</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>

  <span class="va">ps.weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">sample.size</span><span class="op">)</span>
  <span class="va">ps.ate</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
  <span class="va">ebal.weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">sample.size</span><span class="op">)</span>
  <span class="va">ebal.ate</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
  <span class="va">cbps.weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">sample.size</span><span class="op">)</span>
  <span class="va">cbps.ate</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
  <span class="va">energy.weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">sample.size</span><span class="op">)</span>
  <span class="va">energy.ate</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
  <span class="va">kernel.weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">sample.size</span><span class="op">)</span>
  <span class="va">kernel.ate</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
  <span class="va">HRB.weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">sample.size</span><span class="op">)</span>
  <span class="va">HRB.ate</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
  <span class="va">UB.weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">sample.size</span><span class="op">)</span>
  <span class="va">UB.ate</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
    
  <span class="kw">if</span><span class="op">(</span><span class="va">MB.only</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span>
  <span class="va">character</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data.matrix</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">dimension</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">character</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">character</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">myformula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">character</span><span class="op">[</span><span class="fl">1</span> <span class="op">+</span> <span class="va">dimension</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">" ~ "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">character</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">dimension</span><span class="op">]</span>, collapse <span class="op">=</span> <span class="st">"+"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

  <span class="va">ps.weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="va">sample.size</span><span class="op">)</span>
  <span class="va">ps.ate</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
  <span class="va">ps.weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ngreifer.github.io/WeightIt/reference/weightit.html" class="external-link">weightit</a></span><span class="op">(</span><span class="va">myformula</span>, data <span class="op">=</span> <span class="va">data.matrix</span>, estimand <span class="op">=</span> <span class="st">"ATE"</span>, method <span class="op">=</span> <span class="st">"ps"</span><span class="op">)</span><span class="op">$</span><span class="va">weights</span>
  <span class="va">ps.ate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">ps.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">ps.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Y</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">ps.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">ps.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Y</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span>

  <span class="va">ebal.weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ngreifer.github.io/WeightIt/reference/weightit.html" class="external-link">weightit</a></span><span class="op">(</span><span class="va">myformula</span>, data <span class="op">=</span> <span class="va">data.matrix</span>, estimand <span class="op">=</span> <span class="st">"ATE"</span>, method <span class="op">=</span> <span class="st">"ebal"</span><span class="op">)</span><span class="op">$</span><span class="va">weights</span>
  <span class="va">ebal.ate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">ebal.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">ebal.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Y</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">ebal.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">ebal.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Y</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span>
  <span class="va">ebal.weight</span><span class="op">[</span><span class="va">ebal.weight</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>

  <span class="va">cbps.weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ngreifer.github.io/WeightIt/reference/weightit.html" class="external-link">weightit</a></span><span class="op">(</span><span class="va">myformula</span>, data <span class="op">=</span> <span class="va">data.matrix</span>, estimand <span class="op">=</span> <span class="st">"ATE"</span>, method <span class="op">=</span> <span class="st">"cbps"</span>, over <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">weights</span>
  <span class="va">cbps.ate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">cbps.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">cbps.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Y</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">cbps.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">cbps.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Y</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span>
  
  <span class="va">energy.weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ngreifer.github.io/WeightIt/reference/weightit.html" class="external-link">weightit</a></span><span class="op">(</span><span class="va">myformula</span>, data <span class="op">=</span> <span class="va">data.matrix</span>, estimand <span class="op">=</span> <span class="st">"ATE"</span>, method <span class="op">=</span> <span class="st">"energy"</span><span class="op">)</span><span class="op">$</span><span class="va">weights</span>
  <span class="va">energy.ate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">energy.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">energy.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Y</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">energy.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">energy.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Y</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span>
  
  <span class="co"># Sobolev kernel</span>
  <span class="va">Xstd</span> <span class="op">&lt;-</span> <span class="fu">transform.sob</span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">$</span><span class="va">Xstd</span> <span class="co"># standardize X to [0,1]^p</span>
  <span class="va">K</span> <span class="op">&lt;-</span> <span class="fu">getGram</span><span class="op">(</span><span class="va">Xstd</span><span class="op">)</span> <span class="co"># get Gram matrix using Sobolev kernel</span>
  <span class="va">nlam</span> <span class="op">&lt;-</span> <span class="fl">20</span>
  <span class="va">lams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1e-8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, len <span class="op">=</span> <span class="va">nlam</span><span class="op">)</span><span class="op">)</span>

  <span class="co"># compute weights for T=1 / T=0</span>
  <span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ATE.ncb/man/ATE.ncb.SN.html" class="external-link">ATE.ncb.SN</a></span><span class="op">(</span><span class="va">Tr</span>, <span class="va">K</span>, lam1s <span class="op">=</span> <span class="va">lams</span>, traceit <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">$</span><span class="va">warns</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"lambda bound warning!\n"</span><span class="op">)</span>
  <span class="va">fit0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ATE.ncb/man/ATE.ncb.SN.html" class="external-link">ATE.ncb.SN</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">Tr</span>, <span class="va">K</span>, lam1s <span class="op">=</span> <span class="va">lams</span>, traceit <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">fit0</span><span class="op">$</span><span class="va">warns</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"lambda bound warning!\n"</span><span class="op">)</span>
  <span class="va">kernel.ate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">$</span><span class="va">w</span> <span class="op">*</span> <span class="va">Y</span> <span class="op">-</span> <span class="va">fit0</span><span class="op">$</span><span class="va">w</span> <span class="op">*</span> <span class="va">Y</span><span class="op">)</span>
  
  <span class="va">UB.weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">sample.size</span><span class="op">)</span>
  <span class="va">UB1.result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/UB.html">UB</a></span><span class="op">(</span>covariate <span class="op">=</span> <span class="va">X</span>, treat <span class="op">=</span> <span class="va">Tr</span>, group1 <span class="op">=</span> <span class="fl">0</span>, outcome <span class="op">=</span> <span class="va">Y</span>, opti.method <span class="op">=</span> <span class="st">"proximal"</span><span class="op">)</span>
  <span class="va">UB2.result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/UB.html">UB</a></span><span class="op">(</span>covariate <span class="op">=</span> <span class="va">X</span>, treat <span class="op">=</span> <span class="va">Tr</span>, group1 <span class="op">=</span> <span class="fl">1</span>, outcome <span class="op">=</span> <span class="va">Y</span>, opti.method <span class="op">=</span> <span class="st">"proximal"</span><span class="op">)</span>
  <span class="va">UB.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">*</span> <span class="va">UB1.result</span><span class="op">$</span><span class="va">weight</span>
  <span class="va">UB.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">UB2.result</span><span class="op">$</span><span class="va">weight</span>
  <span class="va">UB.ate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">UB.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">UB.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Y</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">UB.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">UB.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Y</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span>
  
  <span class="va">HRB1.result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/HRB.html">HRB</a></span><span class="op">(</span>covariate <span class="op">=</span> <span class="va">X</span>, treat <span class="op">=</span> <span class="va">Tr</span>, group1 <span class="op">=</span> <span class="fl">1</span>, outcome <span class="op">=</span> <span class="va">Y</span><span class="op">)</span>
  <span class="va">HRB2.result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/HRB.html">HRB</a></span><span class="op">(</span>covariate <span class="op">=</span> <span class="va">X</span>, treat <span class="op">=</span> <span class="va">Tr</span>, group1 <span class="op">=</span> <span class="fl">0</span>, outcome <span class="op">=</span> <span class="va">Y</span><span class="op">)</span>
  <span class="va">HRB.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">*</span> <span class="va">HRB1.result</span><span class="op">$</span><span class="va">weight</span>
  <span class="va">HRB.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">HRB2.result</span><span class="op">$</span><span class="va">weight</span>
  <span class="va">HRB.ate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">HRB.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">HRB.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Y</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">-</span>   <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">HRB.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">HRB.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Y</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span>
  <span class="op">}</span>
  
  <span class="va">MB.weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">sample.size</span><span class="op">)</span>
  <span class="va">MB1.result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MB.html">MB</a></span><span class="op">(</span>covariate <span class="op">=</span> <span class="va">X</span>, treat <span class="op">=</span> <span class="va">Tr</span>, group1 <span class="op">=</span> <span class="fl">0</span>, outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">sample.size</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"MB"</span>, opti.method <span class="op">=</span> <span class="st">"proximalC"</span>, rate <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
  <span class="va">MB2.result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MB.html">MB</a></span><span class="op">(</span>covariate <span class="op">=</span> <span class="va">X</span>, treat <span class="op">=</span> <span class="va">Tr</span>, group1 <span class="op">=</span> <span class="fl">1</span>, outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">sample.size</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"MB"</span>, opti.method <span class="op">=</span> <span class="st">"proximalC"</span>, rate <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
  <span class="va">MB.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">*</span> <span class="va">MB1.result</span><span class="op">$</span><span class="va">weight</span>
  <span class="va">MB.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">MB2.result</span><span class="op">$</span><span class="va">weight</span>
  <span class="va">MB.ate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">MB.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">MB.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Y</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">MB.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">MB.weight</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Y</span><span class="op">[</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span>

  
  

  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">ps.weight</span>, ebal <span class="op">=</span> <span class="va">ebal.weight</span>, cbps <span class="op">=</span> <span class="va">cbps.weight</span>, energy <span class="op">=</span> <span class="va">energy.weight</span>, MB <span class="op">=</span> <span class="va">MB.weight</span>, UB <span class="op">=</span> <span class="va">UB.weight</span>, HRB <span class="op">=</span> <span class="va">HRB.weight</span><span class="op">)</span>, ate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">ps.ate</span>, ebal <span class="op">=</span> <span class="va">ebal.ate</span>, cbps <span class="op">=</span> <span class="va">cbps.ate</span>, energy <span class="op">=</span> <span class="va">energy.ate</span>, MB <span class="op">=</span> <span class="va">MB.ate</span>, UB <span class="op">=</span> <span class="va">UB.ate</span>, HRB <span class="op">=</span> <span class="va">HRB.ate</span>, kernel <span class="op">=</span> <span class="va">kernel.ate</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="replication-of-simulation">Replication of Simulation<a class="anchor" aria-label="anchor" href="#replication-of-simulation"></a>
</h2>
<p>We consider four different simulation settings.</p>
<p>The first simulation will be Scenario A in our paper.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">si.data.Wong.Chan</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dimension</span> <span class="op">=</span> <span class="fl">10</span> , <span class="va">sample.size</span> <span class="op">=</span> <span class="fl">200</span><span class="op">)</span><span class="op">{</span>
  <span class="va">sample.matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">sample.size</span>,<span class="va">dimension</span><span class="op">+</span><span class="fl">4</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">sample.size</span><span class="op">)</span><span class="op">{</span>  
    <span class="va">z</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="fl">1</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">dimension</span><span class="op">)</span>, Sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">dimension</span><span class="op">)</span><span class="op">)</span>
    <span class="va">sample.matrix</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">z</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>
    <span class="va">sample.matrix</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">z</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">z</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>
    <span class="va">sample.matrix</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">z</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">+</span><span class="fl">0.6</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>
    <span class="va">sample.matrix</span><span class="op">[</span><span class="va">i</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">z</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">+</span><span class="fl">20</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>
    <span class="va">sample.matrix</span><span class="op">[</span><span class="va">i</span>,<span class="fl">5</span><span class="op">:</span><span class="va">dimension</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">z</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="va">dimension</span><span class="op">]</span>
    <span class="va">p</span>                  <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="fl">0.1</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>
    <span class="va">sample.matrix</span><span class="op">[</span><span class="va">i</span>,<span class="va">dimension</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="va">p</span><span class="op">)</span>
    <span class="va">temp</span>               <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
    <span class="va">sample.matrix</span><span class="op">[</span><span class="va">i</span>,<span class="va">dimension</span><span class="op">+</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">210</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1.5</span><span class="op">*</span><span class="va">sample.matrix</span><span class="op">[</span><span class="va">i</span>,<span class="va">dimension</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="fl">0.5</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">13.7</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">13.7</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">13.7</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">+</span> <span class="fl">13.7</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">temp</span>
    <span class="va">sample.matrix</span><span class="op">[</span><span class="va">i</span>,<span class="va">dimension</span><span class="op">+</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">210</span> <span class="op">+</span> <span class="fl">1</span><span class="op">*</span><span class="op">(</span><span class="fl">13.7</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">13.7</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">13.7</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">+</span> <span class="fl">13.7</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> 
    <span class="va">sample.matrix</span><span class="op">[</span><span class="va">i</span>,<span class="va">dimension</span><span class="op">+</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">210</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="op">(</span><span class="fl">13.7</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">13.7</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">13.7</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">+</span> <span class="fl">13.7</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> 
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">sample.matrix</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="va">dimension</span><span class="op">]</span>, treat <span class="op">=</span> <span class="va">sample.matrix</span><span class="op">[</span>, <span class="va">dimension</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>, Y <span class="op">=</span> <span class="va">sample.matrix</span><span class="op">[</span>, <span class="va">dimension</span> <span class="op">+</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The second simulation will be Scenario B in our paper.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">si.data.interaction</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dimension</span> <span class="op">=</span> <span class="fl">18</span>, <span class="va">sample.size</span> <span class="op">=</span> <span class="fl">200</span><span class="op">)</span><span class="op">{</span>
  <span class="va">sample.matrix</span>        <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span> , <span class="va">sample.size</span> , <span class="va">dimension</span> <span class="op">+</span> <span class="op">(</span><span class="va">dimension</span><span class="op">*</span><span class="op">(</span><span class="va">dimension</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span>
  <span class="va">covariance.matrix.A</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span> , <span class="va">dimension</span> , <span class="va">dimension</span><span class="op">)</span>
  <span class="va">covariance.matrix.B</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span> , <span class="va">dimension</span> , <span class="va">dimension</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">dimension</span><span class="op">)</span><span class="op">{</span><span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">dimension</span><span class="op">)</span><span class="op">{</span><span class="va">covariance.matrix.A</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">^</span><span class="op">{</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">i</span><span class="op">!=</span><span class="va">j</span><span class="op">)</span><span class="op">}</span><span class="op">}</span><span class="op">}</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">dimension</span><span class="op">)</span><span class="op">{</span><span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">dimension</span><span class="op">)</span><span class="op">{</span><span class="va">covariance.matrix.B</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">}</span><span class="op">}</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">sample.size</span><span class="op">)</span><span class="op">{</span>  
    <span class="va">p</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0.5</span><span class="op">)</span>
    <span class="va">z1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="fl">1</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">dimension</span><span class="op">)</span>, Sigma <span class="op">=</span> <span class="va">covariance.matrix.A</span><span class="op">)</span>
    <span class="va">z0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="fl">1</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">dimension</span><span class="op">)</span>, Sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">dimension</span><span class="op">)</span><span class="op">)</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">p</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="va">z</span> <span class="op">&lt;-</span> <span class="va">z1</span><span class="op">}</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">p</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span><span class="va">z</span> <span class="op">&lt;-</span> <span class="va">z0</span><span class="op">}</span> 
    <span class="va">sample.matrix</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">:</span><span class="va">dimension</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">z</span>
    <span class="kw">for</span><span class="op">(</span><span class="va">f</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">dimension</span><span class="op">)</span><span class="op">{</span>
      <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">f</span><span class="op">)</span><span class="op">{</span>
        <span class="va">sample.matrix</span><span class="op">[</span><span class="va">i</span>,<span class="va">dimension</span> <span class="op">+</span> <span class="va">f</span><span class="op">*</span><span class="op">(</span><span class="va">f</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span> <span class="op">+</span> <span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">z</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="va">f</span><span class="op">]</span>
      <span class="op">}</span>
    <span class="op">}</span>
    <span class="va">sample.matrix</span><span class="op">[</span><span class="va">i</span>,<span class="va">dimension</span> <span class="op">+</span> <span class="op">(</span><span class="va">dimension</span><span class="op">*</span><span class="op">(</span><span class="va">dimension</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">p</span>
    <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
    <span class="va">sample.matrix</span><span class="op">[</span><span class="va">i</span>,<span class="va">dimension</span> <span class="op">+</span> <span class="op">(</span><span class="va">dimension</span><span class="op">*</span><span class="op">(</span><span class="va">dimension</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>  <span class="op">+</span> <span class="fl">3</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="va">z</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">9</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">9</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">11</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">11</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">12</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">12</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">13</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">13</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">14</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">14</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">15</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">15</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">16</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">16</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">17</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">17</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">18</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">18</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
    <span class="va">sample.matrix</span><span class="op">[</span><span class="va">i</span>,<span class="va">dimension</span> <span class="op">+</span> <span class="op">(</span><span class="va">dimension</span><span class="op">*</span><span class="op">(</span><span class="va">dimension</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>  <span class="op">+</span> <span class="fl">4</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">z</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">9</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">9</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">11</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">11</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">12</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">12</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">13</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">13</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">14</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">14</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">15</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">15</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">16</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">16</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">17</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">17</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">18</span><span class="op">]</span><span class="op">+</span><span class="va">z</span><span class="op">[</span><span class="fl">18</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
    <span class="va">sample.matrix</span><span class="op">[</span><span class="va">i</span>,<span class="va">dimension</span> <span class="op">+</span> <span class="op">(</span><span class="va">dimension</span><span class="op">*</span><span class="op">(</span><span class="va">dimension</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>  <span class="op">+</span> <span class="fl">2</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">*</span>   <span class="va">sample.matrix</span><span class="op">[</span><span class="va">i</span>,<span class="op">(</span><span class="va">dimension</span> <span class="op">+</span> <span class="va">dimension</span><span class="op">*</span><span class="op">(</span><span class="va">dimension</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">3</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p</span><span class="op">)</span> <span class="op">*</span> <span class="va">sample.matrix</span><span class="op">[</span><span class="va">i</span>,<span class="va">dimension</span> <span class="op">+</span> <span class="op">(</span><span class="va">dimension</span><span class="op">*</span><span class="op">(</span><span class="va">dimension</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">4</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> <span class="va">temp</span>
  <span class="op">}</span>
  <span class="va">true_Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sample.matrix</span><span class="op">[</span><span class="va">i</span>,<span class="va">dimension</span> <span class="op">+</span> <span class="op">(</span><span class="va">dimension</span><span class="op">*</span><span class="op">(</span><span class="va">dimension</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>  <span class="op">+</span> <span class="fl">3</span><span class="op">)</span><span class="op">]</span> <span class="op">-</span> <span class="va">sample.matrix</span><span class="op">[</span><span class="va">i</span>,<span class="va">dimension</span> <span class="op">+</span> <span class="op">(</span><span class="va">dimension</span><span class="op">*</span><span class="op">(</span><span class="va">dimension</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>  <span class="op">+</span> <span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">sample.matrix</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">dimension</span> <span class="op">+</span> <span class="va">dimension</span><span class="op">*</span><span class="op">(</span><span class="va">dimension</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span>, treat <span class="op">=</span> <span class="va">sample.matrix</span><span class="op">[</span>, <span class="va">dimension</span> <span class="op">+</span> <span class="op">(</span><span class="va">dimension</span><span class="op">*</span><span class="op">(</span><span class="va">dimension</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span>, Y <span class="op">=</span> <span class="va">sample.matrix</span><span class="op">[</span>, <span class="va">dimension</span><span class="op">*</span><span class="op">(</span><span class="va">dimension</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">2</span><span class="op">]</span>, true_Y <span class="op">=</span> <span class="va">true_Y</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The third simulation will be Scenario C in our paper. We first
generate treatment indicator <span class="math inline">\(T\)</span> from
<span class="math inline">\(Bernoulli(0.5)\)</span> for each
observation. The observed covariates depend on treatment assignment. If
<span class="math inline">\(T = 1\)</span>, then <span class="math inline">\(X \sim N(1, \Sigma)\)</span> where the jth row and
kth column of <span class="math inline">\(\Sigma\)</span> is <span class="math inline">\(\rho^{|j−k|}\)</span> and we set <span class="math inline">\(\rho = 1/2\)</span>, otherwise, <span class="math inline">\(X \sim N(0,I)\)</span>. The observed outcome is
generated from: <span class="math inline">\(Y(T) = (1 - T)(X_1 + ... +
X_6) + T(X_1 + ... + X_6) / 2\)</span>. In this setting, <span class="math inline">\(E\{ X \mid T = 1\}\)</span> and <span class="math inline">\(E\{ X \mid T = 0\}\)</span> are significantly
different and thus it’s a “Bad Overlap” situation.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">si.data.extreme.mean.diff</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dimension</span> <span class="op">=</span> <span class="fl">10</span>, <span class="va">sample.size</span> <span class="op">=</span> <span class="fl">200</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">covmatrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">dimension</span>, <span class="va">dimension</span><span class="op">)</span>
  <span class="va">treat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">sample.size</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span>
  <span class="va">z1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="va">sample.size</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">dimension</span><span class="op">)</span>, Sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">dimension</span><span class="op">)</span><span class="op">)</span>
  <span class="va">z0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="va">sample.size</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">dimension</span><span class="op">)</span>, Sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">dimension</span><span class="op">)</span><span class="op">)</span>
  <span class="va">X</span> <span class="op">&lt;-</span> <span class="va">treat</span> <span class="op">*</span> <span class="va">z1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">treat</span><span class="op">)</span> <span class="op">*</span> <span class="va">z0</span>
  <span class="va">noise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">sample.size</span><span class="op">)</span>
  <span class="va">Y</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">treat</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span> <span class="op">+</span> <span class="va">noise</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, treat <span class="op">=</span> <span class="va">treat</span>, Y <span class="op">=</span> <span class="va">Y</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The fourth simulation setting corresponds Scenario D to our paper.
The observed covariates are simulated by <span class="math inline">\(X
\sim N(1,I)\)</span>. The treatment indicator is simulated from <span class="math inline">\(T ∼ Bernoulli(\pi(X))\)</span> with <span class="math inline">\(π(X) = 1/(1+19 \exp(X_1+···+X_{10}−10))\)</span>.
The outcome is simulated from <span class="math inline">\(Y =
(1+T)(X_1+···+X_{10}) + \epsilon\)</span>, where <span class="math inline">\(\epsilon \sim N(0,1)\)</span>. In this setting,
<span class="math inline">\(E\{Pr(T = 1 \mid X)\}\)</span> closes to 0
or 1 and thus it’s a “Bad Overlap” situation.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">si.data.extreme_sample_size</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dimension</span> <span class="op">=</span> <span class="fl">10</span>, <span class="va">sample.size</span> <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">sample.size</span> <span class="op">*</span> <span class="va">dimension</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>, nrow <span class="op">=</span> <span class="va">sample.size</span>, ncol <span class="op">=</span> <span class="va">dimension</span><span class="op">)</span>
  <span class="va">ps</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">19</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span> <span class="op">-</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span>
  <span class="va">treat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">sample.size</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">sample.size</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">treat</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="va">ps</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">noise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">sample.size</span><span class="op">)</span>
  <span class="va">Y</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">treat</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span> <span class="op">+</span> <span class="va">noise</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, treat <span class="op">=</span> <span class="va">treat</span>, Y <span class="op">=</span> <span class="va">Y</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>We repeat 200 times.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mainf1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">iteration</span> <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">result1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">iteration</span>, <span class="fl">8</span><span class="op">)</span>
  <span class="va">result2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">iteration</span>, <span class="fl">8</span><span class="op">)</span>
  <span class="va">result3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">iteration</span>, <span class="fl">8</span><span class="op">)</span>
  <span class="va">result4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">iteration</span>, <span class="fl">8</span><span class="op">)</span>
  <span class="va">data2Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">iteration</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">iteration</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">data1</span> <span class="op">&lt;-</span> <span class="fu">si.data.Wong.Chan</span><span class="op">(</span><span class="op">)</span>
    <span class="va">data2</span> <span class="op">&lt;-</span> <span class="fu">si.data.interaction</span><span class="op">(</span><span class="op">)</span>
    <span class="va">data3</span> <span class="op">&lt;-</span> <span class="fu">si.data.extreme.mean.diff</span><span class="op">(</span><span class="op">)</span>
    <span class="va">data4</span> <span class="op">&lt;-</span> <span class="fu">si.data.extreme_sample_size</span><span class="op">(</span><span class="op">)</span>
    <span class="va">result1</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">covbal</span><span class="op">(</span><span class="va">data1</span><span class="op">$</span><span class="va">X</span>, <span class="va">data1</span><span class="op">$</span><span class="va">treat</span>, <span class="va">data1</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span><span class="op">$</span><span class="va">ate</span>
    <span class="va">result2</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">covbal</span><span class="op">(</span><span class="va">data2</span><span class="op">$</span><span class="va">X</span>, <span class="va">data2</span><span class="op">$</span><span class="va">treat</span>, <span class="va">data2</span><span class="op">$</span><span class="va">Y</span>, MB.only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">ate</span>
    <span class="va">result3</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">covbal</span><span class="op">(</span><span class="va">data3</span><span class="op">$</span><span class="va">X</span>, <span class="va">data3</span><span class="op">$</span><span class="va">treat</span>, <span class="va">data3</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span><span class="op">$</span><span class="va">ate</span>
    <span class="va">result4</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">covbal</span><span class="op">(</span><span class="va">data4</span><span class="op">$</span><span class="va">X</span>, <span class="va">data4</span><span class="op">$</span><span class="va">treat</span>, <span class="va">data4</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span><span class="op">$</span><span class="va">ate</span>
    <span class="va">data2Y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">data2</span><span class="op">$</span><span class="va">true_Y</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Wong.Chan <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">result1</span><span class="op">)</span>, si.data.interaction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">result2</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">data2Y</span><span class="op">)</span>, extreme.mean.diff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">result3</span><span class="op">)</span> <span class="op">-</span> <span class="fl">5</span>, extreme_sample_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">result4</span><span class="op">)</span> <span class="op">-</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1124</span><span class="op">)</span>
<span class="fu">mainf1</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; Warning in HRB.weight[Tr == 0] &lt;- sum(Tr == 0) * HRB1.result$weight: number of</span>
<span class="co">#&gt; items to replace is not a multiple of replacement length</span>
<span class="co">#&gt; Warning in HRB.weight[Tr == 1] &lt;- sum(Tr == 1) * HRB2.result$weight: number of</span>
<span class="co">#&gt; items to replace is not a multiple of replacement length</span>
<span class="co">#&gt; Warning in HRB.weight[Tr == 0] &lt;- sum(Tr == 0) * HRB1.result$weight: number of</span>
<span class="co">#&gt; items to replace is not a multiple of replacement length</span>
<span class="co">#&gt; Warning in HRB.weight[Tr == 1] &lt;- sum(Tr == 1) * HRB2.result$weight: number of</span>
<span class="co">#&gt; items to replace is not a multiple of replacement length</span>
<span class="co">#&gt; Warning: Some extreme weights were generated. Examine them with summary() and</span>
<span class="co">#&gt; maybe trim them with trim().</span>
<span class="co">#&gt; Warning in HRB.weight[Tr == 0] &lt;- sum(Tr == 0) * HRB1.result$weight: number of</span>
<span class="co">#&gt; items to replace is not a multiple of replacement length</span>
<span class="co">#&gt; Warning in HRB.weight[Tr == 1] &lt;- sum(Tr == 1) * HRB2.result$weight: number of</span>
<span class="co">#&gt; items to replace is not a multiple of replacement length</span>
<span class="co">#&gt; $Wong.Chan</span>
<span class="co">#&gt; [1]  5.3004208  2.4444747  2.8750008  2.9264136  1.2737122  1.7000496 -1.9583171</span>
<span class="co">#&gt; [8] -0.2689073</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $si.data.interaction</span>
<span class="co">#&gt; [1]        NA        NA        NA        NA -13.29253        NA        NA</span>
<span class="co">#&gt; [8]        NA</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $extreme.mean.diff</span>
<span class="co">#&gt; [1] 10.7574142  0.2603409  5.4738226  2.5315788  0.9648591  3.4998624 13.3972192</span>
<span class="co">#&gt; [8] 10.4897987</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $extreme_sample_size</span>
<span class="co">#&gt; [1]  2.0218650 -0.4265015 -0.5220827 -1.4284431 -0.9795952 -1.1600474 -8.4717449</span>
<span class="co">#&gt; [8] -1.7253433</span></code></pre></div>
<p>We can find that our method has lower bias than other methods because
our purposed method has significantly lower imbalance and thus greatly
outperforms other methods.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Gerifer2022Weightit" class="csl-entry">
Greifer, Noah. 2022. <em>WeightIt: Weighting for Covariate Balance in
Observational Studies</em>.
</div>
<div id="ref-hainmueller2012entropy" class="csl-entry">
Hainmueller, Jens. 2012. <span>“Entropy Balancing for Causal Effects: A
Multivariate Reweighting Method to Produce Balanced Samples in
Observational Studies.”</span> <em>Political Analysis</em> 20 (1):
25–46.
</div>
<div id="ref-huling2020energy" class="csl-entry">
Huling, Jared D, and Simon Mak. 2020. <span>“Energy Balancing of
Covariate Distributions.”</span> <em>arXiv Preprint
arXiv:2004.13962</em>.
</div>
<div id="ref-imai2014covariate" class="csl-entry">
Imai, Kosuke, and Marc Ratkovic. 2014. <span>“Covariate Balancing
Propensity Score.”</span> <em>Journal of the Royal Statistical Society:
Series B (Statistical Methodology)</em> 76 (1): 243–63.
</div>
<div id="ref-imbens2015causal" class="csl-entry">
Imbens, Guido W, and Donald B Rubin. 2015. <em>Causal Inference in
Statistics, Social, and Biomedical Sciences</em>. Cambridge University
Press.
</div>
<div id="ref-rosenbaum1987model" class="csl-entry">
Rosenbaum, Paul R. 1987. <span>“Model-Based Direct Adjustment.”</span>
<em>Journal of the American Statistical Association</em> 82 (398):
387–94.
</div>
<div id="ref-wang2020minimal" class="csl-entry">
Wang, Yixin, and Jose R Zubizarreta. 2020. <span>“Minimal Dispersion
Approximately Balancing Weights: Asymptotic Properties and Practical
Considerations.”</span> <em>Biometrika</em> 107 (1): 93–105.
</div>
<div id="ref-wong2018kernel" class="csl-entry">
Wong, Raymond KW, and Kwun Chuen Gary Chan. 2018. <span>“Kernel-Based
Covariate Functional Balancing for Observational Studies.”</span>
<em>Biometrika</em> 105 (1): 199–213.
</div>
<div id="ref-zhao2019covariate" class="csl-entry">
Zhao, Qingyuan. 2019. <span>“Covariate Balancing Propensity Score by
Tailored Loss Functions.”</span> <em>The Annals of Statistics</em> 47
(2): 965–93.
</div>
<div id="ref-zubizarreta2015stable" class="csl-entry">
Zubizarreta, José R. 2015. <span>“Stable Weights That Balance Covariates
for Estimation with Incomplete Outcome Data.”</span> <em>Journal of the
American Statistical Association</em> 110 (511): 910–22.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Yimin Dai.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
